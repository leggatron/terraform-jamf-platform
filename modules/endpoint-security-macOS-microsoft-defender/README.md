# Microsoft Defender for Endpoint - macOS Module

This module creates the necessary pieces in Jamf Pro to enable Microsoft Defender for Endpoint in your environment.

## Required Variables

### Jamf Pro Account Details

```hcl
jamfpro_auth_method   = "oauth2" ## oauth2 or basic
jamfpro_instance_url  = "https://yourinstance.jamfcloud.com"
jamfpro_client_id     = ""
jamfpro_client_secret = ""
```

### Microsoft Defender Configuration

**Option 1: File Path (Manual Setup)**
```hcl
defender_onboarding_plist_path = "/path/to/WindowsDefenderATPOnboarding.plist"
```

**Option 2: Base64 Encoded (Web Interface)**
```hcl
defender_onboarding_plist = "PD94bWwgdmVyc2lvbj0iMS4wIi..." # Generated by web interface
```

**Note**: You only need to provide **one** of these options, not both.

## What This Module Creates

- **Category**: "Microsoft Defender" for organizing resources
- **Configuration Profiles**:
  - Microsoft Defender MacOS Settings (PPPC, System Extensions, Content Filter, Notifications, Login Items)
  - Microsoft Defender Auto Update Settings (MAU Configuration)
  - Microsoft Defender Onboarding Settings (customer-specific, only created if onboarding plist is provided)
- **Smart Computer Group**: "Microsoft Defender Target Group" for controlled deployment
- **App Installer**: Microsoft Defender deployment from Jamf App Catalog

## Obtaining Your Onboarding Package

1. Sign in to [Microsoft 365 Defender portal](https://security.microsoft.com)
2. Go to **Settings** > **Endpoints** > **Onboarding**
3. Select **macOS** as the operating system
4. Select **Mobile Device Management / Microsoft Intune** as deployment method
5. Click **Download onboarding package**
6. Extract and locate `WindowsDefenderATPOnboarding.plist`

## Implementation Notes

### Configuration Profiles

All configuration profiles are created and automatically scoped to **All Computers** by default. You should modify the scoping in the module or manually in Jamf Pro to target specific devices.

The onboarding profile is only created if you provide either `defender_onboarding_plist_path` or `defender_onboarding_plist`.

### Smart Computer Group - Controlled Deployment

The smart group is configured with restrictive criteria for **controlled, phased deployment**:
- Operating System Version â‰¥ 13.0
- Serial Number like "111222333444555" (placeholder)

**Deployment Strategy:**

1. **Test Phase**: Replace the placeholder serial number with a test device's serial number
2. **Verification**: Confirm Microsoft Defender deploys and functions correctly on the test device
3. **Expand Scope**: Once verified, remove the serial number criterion in Jamf Pro to broaden deployment
4. **Production**: The smart group will then target all devices meeting the OS version requirement

This approach allows you to safely test the deployment before rolling out organization-wide.

## References

- [Microsoft Defender for Endpoint on macOS](https://learn.microsoft.com/en-us/defender-endpoint/microsoft-defender-endpoint-mac)
- [Deploy Microsoft Defender with Jamf Pro](https://learn.microsoft.com/en-us/defender-endpoint/mac-jamfpro-policies)
- [Jamf Pro Configuration Profiles](https://learn.jamf.com/bundle/jamf-pro-documentation-current/page/Configuration_Profiles.html)

## Support

For issues related to:
- **Terraform Module**: Open an issue in this repository
- **Microsoft Defender**: Contact Microsoft Support
- **Jamf Pro**: Contact Jamf Support